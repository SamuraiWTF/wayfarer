version: '3.5'

services:
    ticketapp:
        image: ticket-app:latest
        env_file: 
            - '.default.env'
            - '.env'
        ports:
            - published: 7000
              target: 3000
              mode: host
    ticketapi:
        image: ticket-api:latest
        env_file: 
            - '.default.env'
            - '.env'
        depends_on:
            - sqldb
        networks:
            - internalnet
        ports:
            - published: 3001
              target: 3001
              mode: host
    sqldb:
        image: wayfarer-db:latest
        env_file: 
            - '.default.env'
            - '.env'
        deploy:
            resources:
                limits:
                    memory: 4G
                reservations:
                    memory: 2G
    #    command: --default-authentication-plugin=mysql_native_password
    #    restart: always
        networks:
            - internalnet
        environment:
            MYSQL_ROOT_PASSWORD: changeme
            constraint: node==node01
        ports:
            - "3306:3306"

networks:
    internalnet:
        driver: overlay
        ipam:
            config:
                - subnet: 192.168.18.0/24